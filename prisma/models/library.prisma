model LibraryType {
  id        Int      @id @default(autoincrement())
  name      String
  color     String?
  createdBy Int?
  createdAt DateTime @default(now())

  libraries Library[]
}

model LibraryStatus {
  id        Int      @id @default(autoincrement())
  name      String
  color     String?
  createdBy Int?
  createdAt DateTime @default(now())

  libraries Library[]
}

model Library {
  id          Int       @id @default(autoincrement())
  libraryName String    @unique
  dimension   Int?
  floor       Int?
  capacity    Int?
  statusId    Int
  typeId      Int
  createdBy   Int?
  updatedBy   Int?
  deletedBy   Int?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?

  type       LibraryType       @relation(fields: [typeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  status     LibraryStatus     @relation(fields: [statusId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  locations  LibraryLocation[]
  facilities LibraryFacility[]
  users      UserLibrary[]
}

model LibraryLocation {
  id             Int       @id @default(autoincrement())
  locationName   String
  libraryId      Int
  email          String?
  phone          String?
  address1       String?
  address2       String?
  cityId         Int?
  stateId        Int?
  countryId      Int?
  pincode        String?
  latitude       String?
  longitude      String?
  mapUrl         String?
  libraryShiftId Int?
  isActive       Boolean   @default(true)
  createdBy      Int?
  updatedBy      Int?
  deletedBy      Int?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  deletedAt      DateTime?

  library            Library                @relation(fields: [libraryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  city               City?                  @relation(fields: [cityId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  state              State?                 @relation(fields: [stateId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  country            Country?               @relation(fields: [countryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  libraryFacilities  LibraryFacility[]
  users              UserLibrary[]
  bookings           Booking[]
  libraryShifts      LibraryShiftAndPrice[]
  roomTypes          LibraryRoomType[]
  libraryBookingUnit LibraryBookingUnit[]
}

model LibraryFacility {
  id                Int             @id @default(autoincrement())
  libraryId         Int
  libraryLocationId Int
  facilityId        Int
  description       String?
  createdBy         Int?
  updatedBy         Int?
  deletedBy         Int?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?
  library           Library         @relation(fields: [libraryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  location          LibraryLocation @relation(fields: [libraryLocationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  facility          Facilities      @relation(fields: [facilityId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([libraryId, libraryLocationId, facilityId])
}

model LibraryRoomType {
  id                Int                    @id @default(autoincrement())
  libraryId         Int
  libraryLocationId Int
  roomType          String
  createdBy         Int?
  updatedBy         Int?
  deletedBy         Int?
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  deletedAt         DateTime?
  libraryShifts     LibraryShiftAndPrice[]
  locations         LibraryLocation        @relation(fields: [libraryLocationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model LibraryBookingUnit {
  id                Int                    @id @default(autoincrement())
  libraryId         Int
  libraryLocationId Int
  bookingUnit       String
  createdBy         Int?
  updatedBy         Int?
  deletedBy         Int?
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  deletedAt         DateTime?
  libraryShifts     LibraryShiftAndPrice[]
  locations         LibraryLocation        @relation(fields: [libraryLocationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model LibraryShiftAndPrice {
  id                   Int                @id @default(autoincrement())
  libraryId            Int
  libraryLocationId    Int
  libraryRoomTypeId    Int
  libraryBookingUnitId Int
  period               String
  startTime            String
  endTime              String
  rate                 Float              @default(0)
  createdBy            Int?
  updatedBy            Int?
  deletedBy            Int?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  deletedAt            DateTime?
  locations            LibraryLocation    @relation(fields: [libraryLocationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  roomType             LibraryRoomType    @relation(fields: [libraryRoomTypeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  bookingUnit          LibraryBookingUnit @relation(fields: [libraryBookingUnitId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([libraryId, libraryLocationId, libraryRoomTypeId, libraryBookingUnitId, period])
}

model UserLibrary {
  id                Int      @id @default(autoincrement())
  libraryId         Int
  libraryLocationId Int
  userId            Int
  createdBy         Int?
  createdAt         DateTime @default(now())

  library  Library         @relation(fields: [libraryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  location LibraryLocation @relation(fields: [libraryLocationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user     User            @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([libraryId, libraryLocationId, userId])
}
